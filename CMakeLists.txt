cmake_minimum_required(VERSION 2.8)
project(DisplayCluster)
list(APPEND CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/CMake
                              ${CMAKE_SOURCE_DIR}/CMake/common)
include(GitExternal)

# Versionning
set(RELEASE_VERSION 1) # OFF or ABI version
set(LAST_RELEASE 1.0.0)
set(VERSION_MAJOR 0)
set(VERSION_MINOR 2)
set(VERSION_PATCH 0)

# Scripts
set(DISPLAYCLUSTER_DESCRIPTION "The DisplayCluster project")
set(COMMON_PROJECT_DOMAIN ch.epfl.bluebrain)
include(Common)
include(FindPackages) # Generated by Buildyard and checked in


####### BEGIN REMOVE ?? #########
# required for mixing libraries with full paths and not...
if(COMMAND cmake_policy)
    cmake_policy(SET CMP0003 NEW)
endif(COMMAND cmake_policy)

# show all warnings
set(CMAKE_CXX_FLAGS "-Wall -ftemplate-depth-1024")

if(APPLE)
  # WAR needed when CMAKE_OSX_SYSROOT is set to find /usr/include/turbojpeg.h
  include_directories(SYSTEM /usr/local/../include)
  if(NOT CMAKE_OSX_ARCHITECTURES OR CMAKE_OSX_ARCHITECTURES STREQUAL "")
    if(_CMAKE_OSX_MACHINE MATCHES "ppc")
      set(CMAKE_OSX_ARCHITECTURES "ppc;ppc64" CACHE
        STRING "Build architectures for OS X" FORCE)
    else()
      set(CMAKE_OSX_ARCHITECTURES "i386;x86_64" CACHE
        STRING "Build architectures for OS X" FORCE)
    endif()
  endif()
  if(NOT CMAKE_INSTALL_NAME_DIR)
    set(CMAKE_INSTALL_NAME_DIR "${CMAKE_INSTALL_PREFIX}/lib")
  endif()
endif()

# Used by cmake/modules/DoxygenRule.cmake to install documentation
if(NOT DOC_DIR)
  set(DOC_DIR share/${CMAKE_PROJECT_NAME}/doc)
endif()

# Qt
if(WIN32)
  set(QT_USE_QTMAIN TRUE)
endif()

include(${QT_USE_FILE})
####### END REMOVE ?? #########


# build options
if(OPENGL_FOUND AND MPI_FOUND AND FFMPEG_FOUND AND FCGI_FOUND)
  include_directories(SYSTEM ${MPI_INCLUDE_PATH})
  set(BUILD_CORE_LIBRARY ON)
endif()

if(TUIO_FOUND)
  option(ENABLE_TUIO_TOUCH_LISTENER "Enable TUIO touch listener for multi-touch events" ON)
endif()

option(ENABLE_JOYSTICK_SUPPORT "Enable joystick support" OFF)
option(ENABLE_SKELETON_SUPPORT "EXPERIMENTAL: Enable skeleton tracking interface support" OFF)
option(ENABLE_PYTHON_SUPPORT "Enable Python support" OFF)

if(POPPLER_FOUND)
  option(ENABLE_PDF_SUPPORT "Enable Pdf support using Poppler" ON)
endif()

include_directories(src)

# Targets
add_subdirectory(src)
add_subdirectory(apps)
add_subdirectory(tests)
include(DoxygenRule)
add_subdirectory(doc)

# install example files
install(DIRECTORY examples DESTINATION . COMPONENT examples)
